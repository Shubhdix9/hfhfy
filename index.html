<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrishiSetu - Smart Agriculture Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: #ffffff;
            min-height: 100vh;
        }
        
        .agri-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
        }
        
        .agri-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
        }
        
        .agri-gradient {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 50%, #CDDC39 100%);
        }
        
        .earth-pattern {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 50%, #CDDC39 100%);
        }
        
        .floating-farm {
            position: relative;
        }
        
        .grow-animation {
            opacity: 1;
        }
        
        .harvest-glow {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .section-hidden {
            display: none;
        }
        
        .nav-active {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .leaflet-popup-content-wrapper {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        #map {
            z-index: 1;
            position: relative;
        }
        
        .leaflet-container {
            z-index: 1;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .item-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            box-shadow: 4px 4px 12px rgba(0, 0, 0, 0.1), -4px -4px 12px rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.15), -8px -8px 20px rgba(255, 255, 255, 0.9);
        }
        
        .location-pulse {
            opacity: 1;
        }

        /* AI Chatbot Enhanced Styles */
        .ai-typing {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #f3f4f6;
            border-radius: 12px;
            margin: 8px 0;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #6b7280;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .ai-suggestion-btn {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            margin: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-suggestion-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .ai-prediction {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
        }

        .ai-alert {
            background: linear-gradient(135deg, #fecaca, #fca5a5);
            border-left: 4px solid #ef4444;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
        }

        .ai-success {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-left: 4px solid #10b981;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
        }

        /* Enhanced notification styles */
        .notification-popup {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification-popup.show {
            transform: translateX(0);
        }

        /* AI Analysis Cards */
        .ai-analysis-card {
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            border: 1px solid #a5b4fc;
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
        }

        .ai-score {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .rental-option {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rental-option:hover {
            transform: translateY(-2px);
        }

        .rental-option.selected {
            border-color: #10b981 !important;
            background-color: #d1fae5 !important;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid #d1d5db;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quantity-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .item-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-buy {
            background: #dcfce7;
            color: #166534;
        }

        .badge-sell {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-rent {
            background: #f3e8ff;
            color: #7c3aed;
        }
    </style>
</head>
<body class="bg-white min-h-screen">
    <!-- Header -->
    <header class="agri-gradient shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center floating-farm shadow-lg">
                        <span class="text-3xl">üåæ</span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white tracking-wide">KrishiSetu</h1>
                        <p class="text-green-100 text-sm">Smart Agriculture Platform</p>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-2 items-center">
                    <button onclick="showSection('home')" class="nav-btn nav-active px-6 py-3 rounded-full font-semibold transition-all duration-300">
                        <span class="home-text">üè† Home</span>
                    </button>
                    <button onclick="showSection('map')" class="nav-btn px-6 py-3 rounded-full font-semibold text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300">
                        <span class="map-text">üó∫Ô∏è Live Map</span>
                    </button>
                    <button onclick="showSection('cart')" class="nav-btn px-6 py-3 rounded-full font-semibold text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 relative">
                        <span class="cart-text">üõí Cart</span>
                        <span id="cartCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>
                    <button id="languageToggle" onclick="toggleLanguage()" class="px-4 py-2 bg-white bg-opacity-20 text-white rounded-full font-semibold hover:bg-opacity-30 transition-all duration-300 text-sm">
                        üåê ‡§π‡§ø‡§Ç‡§¶‡•Ä
                    </button>
                </nav>
                <button class="md:hidden text-white text-2xl">‚ò∞</button>
            </div>
        </div>
    </header>

    <!-- Home Section -->
    <section id="homeSection" class="section">
        <!-- Hero Section -->
        <div class="agri-gradient earth-pattern py-16 text-white">
            <div class="container mx-auto px-6 text-center">
                <div class="floating-farm">
                    <h2 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">
                        Smart Agriculture
                        <br><span class="text-yellow-300">Equipment Rental</span>
                    </h2>
                    <p class="text-lg md:text-xl mb-6 max-w-2xl mx-auto opacity-90">
                        Connect directly with equipment owners. Rent agricultural machinery and tools on flexible terms.
                    </p>
                    <div class="flex flex-wrap justify-center gap-3">
                        <button class="bg-white text-green-600 px-6 py-3 rounded-lg text-base font-semibold hover:bg-gray-100 transition-all duration-300">
                            üöÄ Start Listing
                        </button>
                        <button class="border-2 border-white text-white px-6 py-3 rounded-lg text-base font-semibold hover:bg-white hover:text-green-600 transition-all duration-300">
                            üì± Download App
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Categories -->
        <div class="container mx-auto px-6 py-16">
            <h2 class="text-4xl font-bold text-center mb-4 text-green-800">Agricultural Categories</h2>
            <p class="text-center text-gray-600 mb-12 text-lg">Choose your category to explore products and services</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Agro Waste -->
                <div class="agri-card text-center cursor-pointer grow-animation" onclick="showCategoryItems('agrowaste')">
                    <div class="text-5xl mb-4">‚ôªÔ∏è</div>
                    <h3 class="text-xl font-bold text-green-800 mb-3">Agro Waste Trading</h3>
                    <p class="text-gray-600 mb-4 text-sm">Buy and sell agricultural waste directly. Rice straw, wheat residue, cotton stalks, and other crop residues available for trading.</p>
                    <div class="flex flex-wrap justify-center gap-2 mb-4">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Buy</span>
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">Sell</span>
                    </div>
                    <button class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm">
                        Buy & Sell Waste
                    </button>
                </div>

                <!-- Machinery -->
                <div class="agri-card text-center cursor-pointer grow-animation" onclick="showCategoryItems('machinery')">
                    <div class="text-5xl mb-4">üöú</div>
                    <h3 class="text-xl font-bold text-green-800 mb-3">Farm Machinery Rental</h3>
                    <p class="text-gray-600 mb-4 text-sm">Heavy-duty agricultural machinery available for rent. Tractors, harvesters, and specialized equipment for daily or seasonal lease.</p>
                    <div class="flex flex-wrap justify-center gap-2 mb-4">
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">Daily Rent</span>
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">Seasonal Lease</span>
                    </div>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm">
                        Rent Machinery
                    </button>
                </div>

                <!-- Equipment -->
                <div class="agri-card text-center cursor-pointer grow-animation" onclick="showCategoryItems('equipment')">
                    <div class="text-5xl mb-4">üîß</div>
                    <h3 class="text-xl font-bold text-green-800 mb-3">Farm Equipment Rental</h3>
                    <p class="text-gray-600 mb-4 text-sm">Essential farming tools and equipment available for rent. From irrigation systems to harvesting tools - all on flexible lease terms.</p>
                    <div class="flex flex-wrap justify-center gap-2 mb-4">
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">Short-term</span>
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">Long-term</span>
                    </div>
                    <button class="bg-amber-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-amber-700 transition-colors text-sm">
                        Rent Equipment
                    </button>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="bg-gray-50 py-12">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-8 text-green-800">Why Choose KrishiSetu?</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <span class="text-xl">ü§ù</span>
                        </div>
                        <h3 class="text-lg font-semibold mb-1">Direct Connect</h3>
                        <p class="text-gray-600 text-sm">Connect directly with farmers</p>
                    </div>
                    <div class="text-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <span class="text-xl">üí∞</span>
                        </div>
                        <h3 class="text-lg font-semibold mb-1">Best Prices</h3>
                        <p class="text-gray-600 text-sm">No middlemen, fair prices</p>
                    </div>
                    <div class="text-center">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <span class="text-xl">üìç</span>
                        </div>
                        <h3 class="text-lg font-semibold mb-1">Location Based</h3>
                        <p class="text-gray-600 text-sm">Find items near you</p>
                    </div>
                    <div class="text-center">
                        <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <span class="text-xl">üõ°Ô∏è</span>
                        </div>
                        <h3 class="text-lg font-semibold mb-1">Secure Trading</h3>
                        <p class="text-gray-600 text-sm">Safe transactions</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Map Section -->
    <section id="mapSection" class="section section-hidden">
        <div class="container mx-auto px-6 py-8">
            <div class="agri-card p-6 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-green-800 flex items-center">
                        <span class="mr-3">üó∫Ô∏è</span> Live Agricultural Marketplace
                    </h2>
                    <div class="flex space-x-2 flex-wrap gap-2">
                        <button onclick="filterItems('all')" class="filter-btn bg-purple-600 text-white px-3 py-2 rounded-lg text-xs font-medium">All Items</button>
                        <button onclick="filterItems('rent')" class="filter-btn bg-purple-500 text-white px-3 py-2 rounded-lg text-xs font-medium">For Rent</button>
                        <button onclick="filterItems('buy')" class="filter-btn bg-green-500 text-white px-3 py-2 rounded-lg text-xs font-medium">For Sale</button>
                        <button onclick="showNearbyItems()" class="bg-indigo-600 text-white px-3 py-2 rounded-lg text-xs font-medium hover:bg-indigo-700">üìç Nearby</button>
                    </div>
                </div>
                <div class="relative">
                    <div id="map" class="w-full h-96 rounded-2xl shadow-inner"></div>
                </div>
            </div>
            
            <div class="text-center">
                <button onclick="showAddItemModal()" class="bg-green-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:bg-green-700 transition-colors harvest-glow">
                    ‚ûï Add New Item to Map
                </button>
            </div>
        </div>
    </section>

    <!-- Cart Section -->
    <section id="cartSection" class="section section-hidden">
        <div class="container mx-auto px-6 py-8">
            <div class="agri-card p-8">
                <h2 class="text-3xl font-bold text-green-800 mb-8 flex items-center">
                    <span class="mr-3">üõí</span> Your Cart
                </h2>
                <div id="cartItems" class="space-y-4">
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üõí</div>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Your cart is empty</h3>
                        <p class="text-gray-500 mb-6">Start adding items from our marketplace</p>
                        <button onclick="showSection('home')" class="bg-green-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-green-700 transition-colors">
                            Continue Shopping
                        </button>
                    </div>
                </div>
                <div id="cartSummary" class="hidden border-t pt-6 mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-xl font-semibold">Total:</span>
                        <span id="cartTotal" class="text-2xl font-bold text-green-600">‚Çπ0</span>
                    </div>
                    <button onclick="checkout()" class="w-full bg-green-600 text-white py-4 rounded-lg hover:bg-green-700 transition-colors font-semibold text-lg">
                        Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Category Items Modal -->
    <div id="categoryModal" class="fixed inset-0 bg-black bg-opacity-50 z-[9999] hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto relative z-[10000]">
            <div class="flex justify-between items-center mb-6">
                <h3 id="categoryTitle" class="text-3xl font-bold text-green-800"></h3>
                <button onclick="closeCategoryModal()" class="text-gray-500 hover:text-gray-700 text-3xl">&times;</button>
            </div>
            
            <div id="categoryItems" class="category-grid">
                <!-- Items will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Rental Options Modal -->
    <div id="rentalOptionsModal" class="fixed inset-0 bg-black bg-opacity-50 z-[9999] hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto relative z-[10000]">
            <div class="flex justify-between items-center mb-6">
                <h3 id="rentalItemTitle" class="text-2xl font-bold text-green-800">Rental Options</h3>
                <button onclick="closeRentalModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div id="rentalItemDetails" class="mb-6">
                <!-- Item details will be populated here -->
            </div>
            
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-800 mb-3">üìÖ Select Rental Period:</h4>
                
                <div class="rental-option bg-purple-50 border-2 border-purple-200 rounded-lg p-3 cursor-pointer hover:border-purple-400 transition-colors" onclick="selectRentalPeriod('daily')">
                    <div class="flex justify-between items-center">
                        <div>
                            <h5 class="font-semibold text-purple-800 text-sm">Daily Rental</h5>
                            <p class="text-xs text-purple-600">Perfect for short-term needs</p>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-bold text-purple-800" id="dailyPrice">‚Çπ0</p>
                            <p class="text-xs text-purple-600">per day</p>
                        </div>
                    </div>
                </div>
                
                <div class="rental-option bg-blue-50 border-2 border-blue-200 rounded-lg p-3 cursor-pointer hover:border-blue-400 transition-colors" onclick="selectRentalPeriod('weekly')">
                    <div class="flex justify-between items-center">
                        <div>
                            <h5 class="font-semibold text-blue-800 text-sm">Weekly Rental</h5>
                            <p class="text-xs text-blue-600">Save 15% on weekly bookings</p>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-bold text-blue-800" id="weeklyPrice">‚Çπ0</p>
                            <p class="text-xs text-blue-600">per week</p>
                        </div>
                    </div>
                </div>
                
                <div class="rental-option bg-green-50 border-2 border-green-200 rounded-lg p-3 cursor-pointer hover:border-green-400 transition-colors" onclick="selectRentalPeriod('monthly')">
                    <div class="flex justify-between items-center">
                        <div>
                            <h5 class="font-semibold text-green-800 text-sm">Monthly Lease</h5>
                            <p class="text-xs text-green-600">Best value - Save 25%</p>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-bold text-green-800" id="monthlyPrice">‚Çπ0</p>
                            <p class="text-xs text-green-600">per month</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Rental Duration</label>
                    <div class="flex space-x-2">
                        <input type="number" id="rentalQuantity" class="flex-1 p-3 border border-gray-300 rounded-lg" placeholder="1" min="1" value="1" onchange="updateRentalCost()">
                        <span id="rentalUnit" class="flex items-center px-3 bg-gray-100 rounded-lg text-sm text-gray-600">day(s)</span>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium">Total Cost:</span>
                        <span id="totalCost" class="text-xl font-bold text-green-600">‚Çπ0</span>
                    </div>
                    <p class="text-xs text-gray-600">Includes equipment, basic maintenance, and support</p>
                </div>
                
                <button onclick="confirmRental()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold text-lg">
                    üõí Add to Cart
                </button>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="fixed inset-0 bg-black bg-opacity-50 z-[9999] hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto relative z-[10000]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-green-800">Add New Item</h3>
                <button onclick="closeAddModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form onsubmit="handleAddItem(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="itemCategory" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        <option value="agrowaste">‚ôªÔ∏è Agro Waste</option>
                        <option value="machinery">üöú Machinery</option>
                        <option value="equipment">üîß Equipment</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                    <select id="itemType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        <option value="rent">üü£ Available for Rent</option>
                        <option value="buy">üü¢ Available to Buy</option>
                        <option value="sell">üîµ For Sale</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Item Name</label>
                    <input type="text" name="itemName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="e.g., John Deere Tractor" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Price (‚Çπ)</label>
                    <input type="number" name="itemPrice" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="50000" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Contact</label>
                    <input type="text" name="itemContact" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Your phone number" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea name="itemDescription" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" rows="3" placeholder="Detailed description..." required></textarea>
                </div>
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-all font-semibold">
                    üöÄ Add to Marketplace
                </button>
            </form>
        </div>
    </div>

    <!-- Enhanced AI Chatbot -->
    <div id="aiChatbot" class="fixed bottom-6 right-6 z-40">
        <button onclick="toggleAIChat()" class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white text-2xl shadow-lg hover:shadow-xl transition-all harvest-glow">
            ü§ñ
        </button>
        <div id="aiChatWindow" class="hidden absolute bottom-20 right-0 w-96 bg-white rounded-2xl shadow-2xl border">
            <div class="p-4 border-b bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h4 class="font-bold">ü§ñ KrishiSetu AI Assistant</h4>
                    <button onclick="toggleAIChat()" class="text-white hover:text-gray-200">&times;</button>
                </div>
                <p class="text-xs opacity-90 mt-1">Advanced Agricultural Intelligence</p>
            </div>
            <div id="chatMessages" class="p-4 space-y-3 max-h-80 overflow-y-auto">
                <div class="ai-recommendation text-sm">
                    üëã <strong>Namaste! I'm your AI farming assistant.</strong><br>
                    I can help you with:
                    <br>‚Ä¢ üåæ Crop planning & market analysis
                    <br>‚Ä¢ üöú Equipment recommendations
                    <br>‚Ä¢ üå§Ô∏è Weather forecasts & farming tips
                    <br>‚Ä¢ üí∞ Loan guidance & subsidies
                    <br>‚Ä¢ üêõ Pest alerts & soil analysis
                    <br><br><em>Ask me anything in Hindi or English!</em>
                </div>
            </div>
            <div id="aiTyping" class="ai-typing hidden">
                <span class="text-sm text-gray-600 mr-2">AI is thinking</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            <div class="p-4 border-t">
                <div class="flex space-x-2 mb-2">
                    <input type="text" id="chatInput" class="flex-1 p-2 border border-gray-300 rounded-lg text-sm" placeholder="Ask me anything..." onkeypress="if(event.key==='Enter') sendAIMessage()">
                    <button onclick="sendAIMessage()" class="bg-purple-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-600">Send</button>
                </div>
                <div id="aiSuggestions" class="flex flex-wrap gap-1">
                    <button onclick="quickChat('‡§ó‡•á‡§π‡•Ç‡§Ç ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?')" class="ai-suggestion-btn">üåæ ‡§ó‡•á‡§π‡•Ç‡§Ç ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§</button>
                    <button onclick="quickChat('Best tractor for 5 acres?')" class="ai-suggestion-btn">üöú Tractor advice</button>
                    <button onclick="quickChat('‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•à‡§∏‡§æ ‡§∞‡§π‡•á‡§ó‡§æ?')" class="ai-suggestion-btn">üå§Ô∏è ‡§Æ‡•å‡§∏‡§Æ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Notifications -->
    <div id="smartNotifications" class="fixed top-20 right-4 z-50 space-y-2">
        <!-- Notifications will appear here -->
    </div>

    <script>
        // Global variables
        let map;
        let markers = [];
        let marketItems = [];
        let cart = [];
        let currentFilter = 'all';
        let currentSection = 'home';
        let userLocation = null;
        let currentLanguage = 'en';
        let currentRentalItem = null;
        let selectedRentalPeriod = 'daily';

        // Sample data for different categories - Jaipur/JKLU area
        const categoryData = {
            agrowaste: [
                { id: 1, name: "Premium Rice Straw Bales", price: 2500, type: "buy", condition: "excellent", description: "High-quality rice straw bales - 500kg per bale, perfect for cattle feed and bio-fuel", contact: "+91 98765 43210", image: "üåæ", farmer: "Rajesh Kumar", rating: 4.9, verified: true, lat: 26.8467, lng: 75.8056, capacity: "500 kg/bale", quality: "Premium Grade A+" },
                { id: 2, name: "Wheat Residue Bulk Supply", price: 1800, type: "sell", condition: "new", description: "Fresh wheat residue available in bulk - 1000kg lots, ideal for paper industry", contact: "+91 87654 32109", image: "üåæ", farmer: "Priya Sharma", rating: 4.95, verified: true, lat: 26.8567, lng: 75.8156, capacity: "1000 kg/lot", quality: "Premium Industrial Grade" },
                { id: 3, name: "Organic Cotton Stalks", price: 1200, type: "buy", condition: "excellent", description: "Organic cotton stalks for biomass fuel - 750kg bundles, eco-friendly energy source", contact: "+91 76543 21098", image: "üåø", farmer: "Suresh Patel", rating: 4.8, verified: true, lat: 26.8667, lng: 75.8256, capacity: "750 kg/bundle", quality: "Organic Certified A+" },
                { id: 4, name: "Sugarcane Bagasse Premium", price: 3200, type: "sell", condition: "good", description: "High-grade sugarcane bagasse for paper mills - 2000kg lots, industrial quality", contact: "+91 65432 10987", image: "üéã", farmer: "Amit Singh", rating: 4.7, verified: true, lat: 26.8367, lng: 75.7956, capacity: "2000 kg/lot", quality: "Industrial Grade A" }
            ],
            machinery: [
                { id: 5, name: "John Deere 5050D Premium Tractor", price: 2500, dailyRate: 2500, weeklyRate: 16000, monthlyRate: 60000, type: "rent", condition: "excellent", description: "Premium 55 HP tractor with GPS guidance - 12 hours/day operation capacity", contact: "+91 98765 43210", image: "üöú", farmer: "Mohan Lal", rating: 4.95, verified: true, lat: 26.8567, lng: 75.8156, capacity: "55 HP", quality: "Premium Grade A+" },
                { id: 6, name: "Mahindra 575 DI Power Tractor", price: 2000, dailyRate: 2000, weeklyRate: 13000, monthlyRate: 48000, type: "rent", condition: "excellent", description: "50 HP power tractor with advanced hydraulics - daily/weekly/seasonal rental", contact: "+91 87654 32109", image: "üöú", farmer: "Ravi Kumar", rating: 4.85, verified: true, lat: 26.8667, lng: 75.8256, capacity: "50 HP", quality: "Industrial Premium" },
                { id: 7, name: "Advanced Combine Harvester", price: 8000, dailyRate: 8000, weeklyRate: 50000, monthlyRate: 180000, type: "rent", condition: "new", description: "Next-gen combine harvester with AI sorting - 20 acres/day capacity", contact: "+91 76543 21098", image: "üåæ", farmer: "Sunita Devi", rating: 4.9, verified: true, lat: 26.8767, lng: 75.8356, capacity: "20 acres/day", quality: "Export Premium A+" },
                { id: 8, name: "Heavy-Duty Rotavator", price: 1200, dailyRate: 1200, weeklyRate: 7500, monthlyRate: 28000, type: "rent", condition: "excellent", description: "Professional 8.5 feet rotavator - 3 acres/hour processing with depth control", contact: "+91 65432 10987", image: "üîß", farmer: "Vikram Singh", rating: 4.7, verified: true, lat: 26.8367, lng: 75.7956, capacity: "3 acres/hour", quality: "Industrial Premium" }
            ],
            equipment: [
                { id: 9, name: "Premium Drip Irrigation System", price: 800, dailyRate: 800, weeklyRate: 5000, monthlyRate: 18000, type: "rent", condition: "new", description: "Advanced drip irrigation with IoT monitoring - 8 acre coverage capacity", contact: "+91 98765 43210", image: "üíß", farmer: "Deepak Sharma", rating: 4.9, verified: true, lat: 26.8567, lng: 75.8156, capacity: "8 acres", quality: "Premium Grade A+" },
                { id: 10, name: "High-Pressure Sprayer Pump", price: 500, dailyRate: 500, weeklyRate: 3200, monthlyRate: 12000, type: "rent", condition: "excellent", description: "Industrial sprayer pump with GPS tracking - 350L/min capacity", contact: "+91 87654 32109", image: "üí¶", farmer: "Anita Kumari", rating: 4.95, verified: true, lat: 26.8667, lng: 75.8256, capacity: "350 L/min", quality: "Industrial Premium" },
                { id: 11, name: "Solar Water Pump Eco-Smart", price: 600, dailyRate: 600, weeklyRate: 3800, monthlyRate: 14000, type: "rent", condition: "new", description: "Eco-friendly solar water pump - 15000L/hour capacity with battery backup", contact: "+91 76543 21098", image: "‚òÄÔ∏è", farmer: "Govind Meena", rating: 4.8, verified: true, lat: 26.8767, lng: 75.8356, capacity: "15000 L/hour", quality: "Eco-Premium A+" },
                { id: 12, name: "Precision Seed Drill", price: 900, dailyRate: 900, weeklyRate: 5700, monthlyRate: 21000, type: "rent", condition: "excellent", description: "GPS-guided precision seed drill - 12 row capacity with variable rate seeding", contact: "+91 65432 10987", image: "üå±", farmer: "Laxmi Devi", rating: 4.85, verified: true, lat: 26.8367, lng: 75.7956, capacity: "12 rows", quality: "Precision Premium" }
            ]
        };

        // Enhanced AI responses
        const aiResponses = {
            en: {
                'wheat': "üåæ AI Analysis: Wheat prices trending upward! Current: ‚Çπ2,200/quintal. AI predicts 8% increase next week. Best selling window: March 15-25.",
                '‡§ó‡•á‡§π‡•Ç‡§Ç': "üåæ AI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£: ‡§ó‡•á‡§π‡•Ç‡§Ç ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§‡•á‡§Ç ‡§¨‡§¢‡§º ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç! ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§®: ‚Çπ2,200/‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤‡•§ AI ‡§Ö‡§ó‡§≤‡•á ‡§∏‡§™‡•ç‡§§‡§æ‡§π 8% ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§",
                'tractor': "üöú AI Equipment Match: Found 2 optimal tractors. John Deere 5050D (‚Çπ2.5K/day) - AI score: 9.2/10, fuel efficient. Mahindra 575 DI (‚Çπ2K/day) - AI score: 8.8/10.",
                'weather': "üå§Ô∏è AI Weather Intelligence: Perfect farming conditions! 28¬∞C, 65% humidity, 12km/h winds. 5-day forecast: Sunny with 2mm rain on day 3.",
                'default': "ü§ñ AI Agricultural Assistant: I can help with crop planning, equipment recommendations, market analysis, weather forecasts, and more. What would you like to know?"
            }
        };

        // Core application functions
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('section-hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').classList.remove('section-hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('nav-active');
            });
            
            event.target.classList.add('nav-active');
            currentSection = sectionName;
            
            // Initialize map if switching to map section
            if (sectionName === 'map' && !map) {
                setTimeout(initializeMap, 100);
            }
        }

        function showCategoryItems(category) {
            const modal = document.getElementById('categoryModal');
            const title = document.getElementById('categoryTitle');
            const itemsContainer = document.getElementById('categoryItems');
            
            // Set title based on category
            const categoryTitles = {
                'agrowaste': '‚ôªÔ∏è Agro Waste Trading',
                'machinery': 'üöú Farm Machinery Rental',
                'equipment': 'üîß Farm Equipment Rental'
            };
            
            title.textContent = categoryTitles[category] || 'Items';
            
            // Load items for this category
            const items = categoryData[category] || [];
            
            itemsContainer.innerHTML = items.map(item => {
                const badgeClass = item.type === 'buy' ? 'badge-buy' : item.type === 'sell' ? 'badge-sell' : 'badge-rent';
                const badgeText = item.type === 'buy' ? 'Available to Buy' : item.type === 'sell' ? 'For Sale' : 'For Rent';
                
                return `
                    <div class="item-card p-6">
                        <div class="flex items-start space-x-4 mb-4">
                            <div class="text-4xl">${item.image}</div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="text-lg font-bold text-green-800">${item.name}</h4>
                                    <span class="item-badge ${badgeClass}">${badgeText}</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">${item.description}</p>
                                <div class="flex items-center space-x-3 mb-3">
                                    <span class="text-yellow-500 text-sm">‚≠ê ${item.rating}</span>
                                    <span class="text-green-600 text-xs">‚úì ${item.verified ? 'Verified' : 'Unverified'}</span>
                                    <span class="text-blue-600 text-xs">${item.farmer}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3 mb-4 text-xs">
                            <div class="bg-gray-50 p-2 rounded">
                                <span class="font-medium">Capacity:</span> ${item.capacity}
                            </div>
                            <div class="bg-gray-50 p-2 rounded">
                                <span class="font-medium">Quality:</span> ${item.quality}
                            </div>
                            <div class="bg-gray-50 p-2 rounded">
                                <span class="font-medium">Condition:</span> ${item.condition}
                            </div>
                            <div class="bg-gray-50 p-2 rounded">
                                <span class="font-medium">Type:</span> ${item.type}
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-2xl font-bold text-green-600">‚Çπ${item.price.toLocaleString()}</span>
                                <span class="text-sm text-gray-500">${item.type === 'rent' ? '/day' : item.type === 'buy' ? '' : ''}</span>
                            </div>
                            <div class="space-x-2">
                                ${item.type === 'rent' ? 
                                    `<button onclick="showRentalOptions(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                                            class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700 transition-colors">
                                        üìÖ Rent Options
                                    </button>` :
                                    `<button onclick="buyItem(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                                            class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700 transition-colors">
                                        ${item.type === 'buy' ? 'üõí Buy Now' : 'üí∞ Contact Seller'}
                                    </button>`
                                }
                                <button onclick="contactSeller('${item.contact}')" 
                                        class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                                    üìû Contact
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            modal.classList.remove('hidden');
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.add('hidden');
        }

        function showRentalOptions(item) {
            currentRentalItem = item;
            document.getElementById('rentalItemTitle').textContent = item.name;
            
            // Update item details
            document.getElementById('rentalItemDetails').innerHTML = `
                <div class="flex items-center space-x-4 mb-4">
                    <div class="text-4xl">${item.image}</div>
                    <div>
                        <h4 class="font-semibold text-gray-800">${item.name}</h4>
                        <p class="text-sm text-gray-600">${item.description}</p>
                        <div class="flex items-center space-x-2 mt-1">
                            <span class="text-yellow-500">‚≠ê ${item.rating}</span>
                            <span class="text-green-600 text-xs">‚úì ${item.verified ? 'Verified' : 'Unverified'}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Update rental prices
            document.getElementById('dailyPrice').textContent = `‚Çπ${item.dailyRate || item.price}`;
            document.getElementById('weeklyPrice').textContent = `‚Çπ${item.weeklyRate || (item.price * 6)}`;
            document.getElementById('monthlyPrice').textContent = `‚Çπ${item.monthlyRate || (item.price * 25)}`;
            
            // Reset to daily by default
            selectRentalPeriod('daily');
            
            // Show modal
            document.getElementById('rentalOptionsModal').classList.remove('hidden');
        }

        function closeRentalModal() {
            document.getElementById('rentalOptionsModal').classList.add('hidden');
        }

        function selectRentalPeriod(period) {
            selectedRentalPeriod = period;
            
            // Remove active class from all options
            document.querySelectorAll('.rental-option').forEach(option => {
                option.classList.remove('border-green-400', 'bg-green-50', 'selected');
                option.classList.add('border-gray-200');
            });
            
            // Add active class to selected option
            const selectedOption = document.querySelector(`.rental-option[onclick="selectRentalPeriod('${period}')"]`);
            if (selectedOption) {
                selectedOption.classList.add('border-green-400', 'bg-green-50', 'selected');
                selectedOption.classList.remove('border-gray-200');
            }
            
            // Update unit display
            const unitMap = {
                'daily': 'day(s)',
                'weekly': 'week(s)', 
                'monthly': 'month(s)'
            };
            document.getElementById('rentalUnit').textContent = unitMap[period];
            
            // Update cost
            updateRentalCost();
        }

        function updateRentalCost() {
            if (!currentRentalItem) return;
            
            const quantity = parseInt(document.getElementById('rentalQuantity').value) || 1;
            let unitPrice = 0;
            
            switch(selectedRentalPeriod) {
                case 'daily':
                    unitPrice = currentRentalItem.dailyRate || currentRentalItem.price;
                    break;
                case 'weekly':
                    unitPrice = currentRentalItem.weeklyRate || (currentRentalItem.price * 6);
                    break;
                case 'monthly':
                    unitPrice = currentRentalItem.monthlyRate || (currentRentalItem.price * 25);
                    break;
            }
            
            const totalCost = unitPrice * quantity;
            document.getElementById('totalCost').textContent = `‚Çπ${totalCost.toLocaleString()}`;
        }

        function confirmRental() {
            if (!currentRentalItem) return;
            
            const quantity = parseInt(document.getElementById('rentalQuantity').value) || 1;
            let unitPrice = 0;
            
            switch(selectedRentalPeriod) {
                case 'daily':
                    unitPrice = currentRentalItem.dailyRate || currentRentalItem.price;
                    break;
                case 'weekly':
                    unitPrice = currentRentalItem.weeklyRate || (currentRentalItem.price * 6);
                    break;
                case 'monthly':
                    unitPrice = currentRentalItem.monthlyRate || (currentRentalItem.price * 25);
                    break;
            }
            
            const cartItem = {
                ...currentRentalItem,
                rentalPeriod: selectedRentalPeriod,
                quantity: quantity,
                unitPrice: unitPrice,
                totalPrice: unitPrice * quantity,
                cartType: 'rental'
            };
            
            addToCart(cartItem);
            closeRentalModal();
            showNotification(`${currentRentalItem.name} added to cart for ${selectedRentalPeriod} rental!`, 'success');
        }

        function buyItem(item) {
            const cartItem = {
                ...item,
                quantity: 1,
                unitPrice: item.price,
                totalPrice: item.price,
                cartType: 'purchase'
            };
            
            addToCart(cartItem);
            showNotification(`${item.name} added to cart!`, 'success');
        }

        function addToCart(item) {
            const existingItemIndex = cart.findIndex(cartItem => 
                cartItem.id === item.id && 
                cartItem.rentalPeriod === item.rentalPeriod &&
                cartItem.cartType === item.cartType
            );
            
            if (existingItemIndex !== -1) {
                cart[existingItemIndex].quantity += item.quantity;
                cart[existingItemIndex].totalPrice = cart[existingItemIndex].unitPrice * cart[existingItemIndex].quantity;
            } else {
                cart.push(item);
            }
            
            updateCartDisplay();
            updateCartCount();
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartSummary = document.getElementById('cartSummary');
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üõí</div>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Your cart is empty</h3>
                        <p class="text-gray-500 mb-6">Start adding items from our marketplace</p>
                        <button onclick="showSection('home')" class="bg-green-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-green-700 transition-colors">
                            Continue Shopping
                        </button>
                    </div>
                `;
                cartSummary.classList.add('hidden');
            } else {
                cartItems.innerHTML = cart.map((item, index) => `
                    <div class="agri-card p-4 flex items-center space-x-4">
                        <div class="text-3xl">${item.image}</div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-green-800">${item.name}</h4>
                            <p class="text-sm text-gray-600">
                                ${item.cartType === 'rental' ? 
                                    `${item.rentalPeriod} rental - ${item.quantity} ${item.rentalPeriod}(s)` : 
                                    `Purchase - Quantity: ${item.quantity}`
                                }
                            </p>
                            <p class="text-sm text-blue-600">Seller: ${item.farmer}</p>
                            <p class="text-lg font-bold text-green-600">‚Çπ${item.totalPrice.toLocaleString()}</p>
                        </div>
                        <div class="quantity-controls">
                            <button onclick="changeQuantity(${index}, -1)" class="quantity-btn">-</button>
                            <span class="px-3 py-1 bg-gray-100 rounded">${item.quantity}</span>
                            <button onclick="changeQuantity(${index}, 1)" class="quantity-btn">+</button>
                        </div>
                        <button onclick="removeFromCart(${index})" class="text-red-500 hover:text-red-700 text-xl ml-4">
                            üóëÔ∏è
                        </button>
                    </div>
                `).join('');
                
                const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
                document.getElementById('cartTotal').textContent = `‚Çπ${total.toLocaleString()}`;
                cartSummary.classList.remove('hidden');
            }
        }

        function changeQuantity(index, change) {
            if (cart[index]) {
                cart[index].quantity = Math.max(1, cart[index].quantity + change);
                cart[index].totalPrice = cart[index].unitPrice * cart[index].quantity;
                updateCartDisplay();
                updateCartCount();
            }
        }

        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCount = document.getElementById('cartCount');
            
            if (count > 0) {
                cartCount.textContent = count;
                cartCount.classList.remove('hidden');
            } else {
                cartCount.classList.add('hidden');
            }
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
            updateCartCount();
            showNotification('Item removed from cart', 'info');
        }

        function checkout() {
            if (cart.length === 0) return;
            
            const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            showNotification(`Processing checkout for ‚Çπ${total.toLocaleString()}...`, 'success');
            
            setTimeout(() => {
                cart = [];
                updateCartDisplay();
                updateCartCount();
                showNotification('Order placed successfully! You will be contacted soon.', 'success');
            }, 2000);
        }

        function initializeMap() {
            if (map) return;
            
            map = L.map('map').setView([26.8467, 75.8056], 12);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            loadMarketItems();
        }

        function loadMarketItems() {
            // Combine all category data
            marketItems = [
                ...categoryData.agrowaste,
                ...categoryData.machinery,
                ...categoryData.equipment
            ];
            
            if (map) {
                // Clear existing markers
                markers.forEach(marker => map.removeLayer(marker));
                markers = [];
                
                // Add markers for each item
                marketItems.forEach(item => {
                    const marker = L.marker([item.lat, item.lng]).addTo(map);
                    
                    const popupContent = `
                        <div class="p-3 min-w-64">
                            <div class="flex items-center space-x-3 mb-3">
                                <span class="text-2xl">${item.image}</span>
                                <div>
                                    <h4 class="font-bold text-green-800">${item.name}</h4>
                                    <p class="text-sm text-gray-600">${item.farmer}</p>
                                </div>
                            </div>
                            <p class="text-sm mb-3">${item.description}</p>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-lg font-bold text-green-600">‚Çπ${item.price.toLocaleString()}${item.type === 'rent' ? '/day' : ''}</span>
                                <span class="text-yellow-500">‚≠ê ${item.rating}</span>
                            </div>
                            ${item.type === 'rent' ? 
                                `<button onclick="showRentalOptions(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                                        class="w-full bg-purple-600 text-white py-2 rounded-lg text-sm hover:bg-purple-700">
                                    üìÖ View Rental Options
                                </button>` :
                                `<button onclick="buyItem(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                                        class="w-full bg-green-600 text-white py-2 rounded-lg text-sm hover:bg-green-700">
                                    ${item.type === 'buy' ? 'üõí Buy Now' : 'üí∞ Contact Seller'}
                                </button>`
                            }
                        </div>
                    `;
                    
                    marker.bindPopup(popupContent);
                    markers.push(marker);
                });
            }
        }

        function filterItems(filter) {
            currentFilter = filter;
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-purple-600', 'bg-green-600');
                btn.classList.add('bg-purple-500');
            });
            event.target.classList.remove('bg-purple-500');
            if (filter === 'buy') {
                event.target.classList.add('bg-green-600');
            } else {
                event.target.classList.add('bg-purple-600');
            }
            
            showNotification(`Showing ${filter} items`, 'info');
        }

        function showNearbyItems() {
            showNotification('Showing items within 10km radius', 'info');
        }

        function showAddItemModal() {
            document.getElementById('addItemModal').classList.remove('hidden');
        }

        function closeAddModal() {
            document.getElementById('addItemModal').classList.add('hidden');
        }

        function handleAddItem(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const newItem = {
                id: Date.now(),
                name: formData.get('itemName'),
                price: parseInt(formData.get('itemPrice')),
                description: formData.get('itemDescription'),
                contact: formData.get('itemContact'),
                type: formData.get('itemType'),
                condition: 'new',
                lat: userLocation?.lat || 26.8467,
                lng: userLocation?.lng || 75.8056,
                farmer: 'You',
                rating: 5.0,
                verified: true,
                image: 'üÜï',
                capacity: 'N/A',
                quality: 'Premium'
            };
            
            // Add to appropriate category
            const category = formData.get('itemCategory');
            categoryData[category].push(newItem);
            
            loadMarketItems();
            closeAddModal();
            showNotification('Item added to marketplace successfully!', 'success');
            
            e.target.reset();
        }

        function contactSeller(phone) {
            showNotification(`Connecting you to ${phone}...`, 'info');
            setTimeout(() => {
                window.open(`tel:${phone}`, '_blank');
            }, 1000);
        }

        function toggleAIChat() {
            const chatWindow = document.getElementById('aiChatWindow');
            chatWindow.classList.toggle('hidden');
        }

        function sendAIMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            document.getElementById('aiTyping').classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('aiTyping').classList.add('hidden');
                const response = getAIResponse(message);
                addChatMessage(response, 'ai');
            }, 1500);
        }

        function addChatMessage(message, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            if (sender === 'user') {
                messageDiv.className = 'text-right';
                messageDiv.innerHTML = `
                    <div class="inline-block bg-purple-500 text-white p-3 rounded-lg max-w-xs text-sm">
                        ${message}
                    </div>
                `;
            } else {
                messageDiv.className = 'text-left';
                messageDiv.innerHTML = `
                    <div class="inline-block bg-gray-100 p-3 rounded-lg max-w-xs text-sm">
                        ${message}
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            const responses = aiResponses[currentLanguage] || aiResponses.en;
            
            for (const [key, response] of Object.entries(responses)) {
                if (lowerMessage.includes(key.toLowerCase())) {
                    return response;
                }
            }
            
            return responses.default;
        }

        function quickChat(message) {
            document.getElementById('chatInput').value = message;
            sendAIMessage();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification-popup bg-white border-l-4 p-4 rounded-lg shadow-lg mb-2 transform transition-transform duration-300 ${
                type === 'success' ? 'border-green-500' : 
                type === 'error' ? 'border-red-500' : 
                'border-blue-500'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="text-2xl mr-3">
                        ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}
                    </span>
                    <p class="text-sm font-medium">${message}</p>
                </div>
            `;
            
            document.getElementById('smartNotifications').appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'hi' : 'en';
            document.getElementById('languageToggle').textContent = currentLanguage === 'en' ? 'üåê ‡§π‡§ø‡§Ç‡§¶‡•Ä' : 'üåê English';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Show welcome notification
            setTimeout(() => {
                showNotification('Welcome to KrishiSetu! Explore our smart agricultural marketplace.', 'success');
            }, 1000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98437658f2dc8aee',t:'MTc1ODcyOTI4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
